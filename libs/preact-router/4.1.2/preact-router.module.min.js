import{createContext as n,Component as t,toChildArray as r,cloneElement as i,h as o}from"preact";import{useContext as e,useState as u,useEffect as f}from"preact/hooks";var a={};function c(t,e){for(var n in e)t[n]=e[n];return t}function s(t,e,n){var r,o=/(?:\?([^#]*))?(#.*)?$/,i=t.match(o),u={};if(i&&i[1])for(var c=i[1].split("&"),s=0;s<c.length;s++){var p=c[s].split("=");u[decodeURIComponent(p[0])]=decodeURIComponent(p.slice(1).join("="))}t=d(t.replace(o,"")),e=d(e||"");for(var f=Math.max(t.length,e.length),l=0;l<f;l++)if(e[l]&&":"===e[l].charAt(0)){var h=e[l].replace(/(^:|[+*?]+$)/g,""),m=(e[l].match(/[+*?]+$/)||a)[0]||"",v=~m.indexOf("+"),g=~m.indexOf("*"),U=t[l]||"";if(!U&&!g&&(m.indexOf("?")<0||v)){r=!1;break}if(u[h]=decodeURIComponent(U),v||g){u[h]=t.slice(l).map(decodeURIComponent).join("/");break}}else if(e[l]!==t[l]){r=!1;break}return(!0===n.default||!1!==r)&&u}function h(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function v(t,e){return t.index=e,t.rank=t.props.default?0:d(t.props.path).map(l).join(""),t.props}function d(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function l(t){return":"==t.charAt(0)?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var p={},m=[],y=[],U=null,g={url:R()},k=n(g);function C(){var t,n=e(k);return n===g&&(t=u()[1],f(function(){return y.push(t),function(){return y.splice(y.indexOf(t),1)}},[])),[n,$]}function R(){var t;return""+((t=U&&U.location?U.location:U&&U.getCurrentLocation?U.getCurrentLocation():"undefined"!=typeof location?location:p).pathname||"")+(t.search||"")}function $(t,e){return void 0===e&&(e=!1),"string"!=typeof t&&t.url&&(e=t.replace,t=t.url),function(t){for(var e=m.length;e--;)if(m[e].canRoute(t))return 1}(t)&&(n=t,void 0===(e=e?"replace":"push")&&(e="push"),U&&U[e]?U[e](n):"undefined"!=typeof history&&history[e+"State"]&&history[e+"State"](null,null,n)),I(t);var n}function I(t){for(var e=!1,n=0;n<m.length;n++)m[n].routeTo(t)&&(e=!0);return e}function M(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),t=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return $(e)}}function b(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function W(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do{if("a"===e.localName&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(M(e))return b(t)}}while(e=e.parentNode)}}var w=!1;function D(t){t.history&&(U=t.history),this.state={url:t.url||R()}}c(D.prototype=new t,{shouldComponentUpdate:function(t){return!0!==t.static||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=r(this.props.children);return void 0!==this.g(e,t)},routeTo:function(t){this.setState({url:t});t=this.canRoute(t);return this.p||this.forceUpdate(),t},componentWillMount:function(){this.p=!0},componentDidMount:function(){var e=this;w||(w=!0,U||addEventListener("popstate",function(){I(R())}),addEventListener("click",W)),m.push(this),U&&(this.u=U.listen(function(t){t=t.location||t;e.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){"function"==typeof this.u&&this.u(),m.splice(m.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(v).sort(h);for(var n=0;n<t.length;n++){var r=t[n],o=s(e,r.props.path,r.props);if(o)return[r,o]}},render:function(t,e){var n,a,u=t.onChange,e=e.url,s=this.c,t=this.g(r(t.children),e);if(t&&(a=i(t[0],c(c({url:e,matches:n=t[1]},n),{key:void 0,ref:void 0}))),e!==(s&&s.url)){c(g,s=this.c={url:e,previous:s&&s.url,current:a,path:a?a.props.path:null,matches:n}),s.router=this,s.active=a?[a]:[];for(var p=y.length;p--;)y[p]({});"function"==typeof u&&u(s)}return o(k.Provider,{value:s},a)}});var E=function(t){return o("a",c({onClick:W},t))},L=function(t){return o(t.component,t)};export{E as Link,L as Route,D as Router,D as default,s as exec,R as getCurrentUrl,$ as route,C as useRouter};